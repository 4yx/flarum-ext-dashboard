module.exports=function(t){var e={};function n(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(s,r,function(e){return t[e]}.bind(null,r));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=15)}([function(t,e){t.exports=flarum.core.compat["helpers/icon"]},function(t,e){t.exports=flarum.core.compat["components/Button"]},function(t,e){t.exports=flarum.core.compat["components/DashboardWidget"]},function(t,e){t.exports=flarum.core.compat["components/Modal"]},function(t,e){t.exports=flarum.core.compat.extend},function(t,e){t.exports=flarum.core.compat["components/AdminNav"]},function(t,e){t.exports=flarum.core.compat["components/DashboardPage"]},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(10),r=n(11),a=n(13),o=()=>{},i=new r.default.TimeoutError;e.default=class extends s{constructor(t){if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=o,this._resolveIdle=o,!("number"==typeof(t=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:a.default},t)).concurrency&&t.concurrency>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${t.concurrency}\` (${typeof t.concurrency})`);if(!("number"==typeof t.intervalCap&&t.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${t.intervalCap}\` (${typeof t.intervalCap})`);if(void 0===t.interval||!(Number.isFinite(t.interval)&&t.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${t.interval}\` (${typeof t.interval})`);this._carryoverConcurrencyCount=t.carryoverConcurrencyCount,this._isIntervalIgnored=t.intervalCap===1/0||0===t.interval,this._intervalCap=t.intervalCap,this._interval=t.interval,this._queue=new t.queueClass,this._queueClass=t.queueClass,this._concurrency=t.concurrency,this._timeout=t.timeout,this._throwOnTimeout=!0===t.throwOnTimeout,this._paused=!1===t.autoStart}get doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}next(){this._pendingCount--,this.tryToStartAnother()}resolvePromises(){this._resolveEmpty(),this._resolveEmpty=o,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=o)}onResumeInterval(){this.onInterval(),this.initializeIntervalIfNeeded(),this._timeoutId=void 0}intervalPaused(){const t=Date.now();if(void 0===this._intervalId){const e=this._intervalEnd-t;if(!(e<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout(()=>{this.onResumeInterval()},e)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this.resolvePromises(),!1;if(!this._paused){const t=!this.intervalPaused();if(this.doesIntervalAllowAnother&&this.doesConcurrentAllowAnother)return this.emit("active"),this._queue.dequeue()(),t&&this.initializeIntervalIfNeeded(),!0}return!1}initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval(()=>{this.onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}onInterval(){for(0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;this.tryToStartAnother(););}async add(t,e){return new Promise((n,s)=>{this._queue.enqueue(async()=>{this._pendingCount++,this._intervalCount++;try{const e=void 0===this._timeout?t():r.default(Promise.resolve(t()),this._timeout,()=>{this._throwOnTimeout&&s(i)});n(await e)}catch(t){s(t)}this.next()},e),this.tryToStartAnother()})}async addAll(t,e){return Promise.all(t.map(t=>this.add(t,e)))}start(){if(this._paused)for(this._paused=!1;this.tryToStartAnother(););}pause(){this._paused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise(t=>{const e=this._resolveEmpty;this._resolveEmpty=()=>{e(),t()}})}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise(t=>{const e=this._resolveIdle;this._resolveIdle=()=>{e(),t()}})}get size(){return this._queue.size}get pending(){return this._pendingCount}get isPaused(){return this._paused}set timeout(t){this._timeout=t}get timeout(){return this._timeout}}},function(t,e){t.exports=flarum.core.compat["components/Switch"]},function(t,e){t.exports=flarum.core.compat["components/LoadingIndicator"]},function(t,e,n){"use strict";var s=Object.prototype.hasOwnProperty,r="~";function a(){}function o(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function i(t,e,n,s,a){if("function"!=typeof n)throw new TypeError("The listener must be a function");var i=new o(n,s||t,a),u=r?r+e:e;return t._events[u]?t._events[u].fn?t._events[u]=[t._events[u],i]:t._events[u].push(i):(t._events[u]=i,t._eventsCount++),t}function u(t,e){0==--t._eventsCount?t._events=new a:delete t._events[e]}function l(){this._events=new a,this._eventsCount=0}Object.create&&(a.prototype=Object.create(null),(new a).__proto__||(r=!1)),l.prototype.eventNames=function(){var t,e,n=[];if(0===this._eventsCount)return n;for(e in t=this._events)s.call(t,e)&&n.push(r?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},l.prototype.listeners=function(t){var e=r?r+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var s=0,a=n.length,o=new Array(a);s<a;s++)o[s]=n[s].fn;return o},l.prototype.listenerCount=function(t){var e=r?r+t:t,n=this._events[e];return n?n.fn?1:n.length:0},l.prototype.emit=function(t,e,n,s,a,o){var i=r?r+t:t;if(!this._events[i])return!1;var u,l,c=this._events[i],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,n),!0;case 4:return c.fn.call(c.context,e,n,s),!0;case 5:return c.fn.call(c.context,e,n,s,a),!0;case 6:return c.fn.call(c.context,e,n,s,a,o),!0}for(l=1,u=new Array(d-1);l<d;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var h,p=c.length;for(l=0;l<p;l++)switch(c[l].once&&this.removeListener(t,c[l].fn,void 0,!0),d){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,e);break;case 3:c[l].fn.call(c[l].context,e,n);break;case 4:c[l].fn.call(c[l].context,e,n,s);break;default:if(!u)for(h=1,u=new Array(d-1);h<d;h++)u[h-1]=arguments[h];c[l].fn.apply(c[l].context,u)}}return!0},l.prototype.on=function(t,e,n){return i(this,t,e,n,!1)},l.prototype.once=function(t,e,n){return i(this,t,e,n,!0)},l.prototype.removeListener=function(t,e,n,s){var a=r?r+t:t;if(!this._events[a])return this;if(!e)return u(this,a),this;var o=this._events[a];if(o.fn)o.fn!==e||s&&!o.once||n&&o.context!==n||u(this,a);else{for(var i=0,l=[],c=o.length;i<c;i++)(o[i].fn!==e||s&&!o[i].once||n&&o[i].context!==n)&&l.push(o[i]);l.length?this._events[a]=1===l.length?l[0]:l:u(this,a)}return this},l.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&u(this,e)):(this._events=new a,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=r,l.EventEmitter=l,t.exports=l},function(t,e,n){"use strict";const s=n(12);class r extends Error{constructor(t){super(t),this.name="TimeoutError"}}const a=(t,e,n)=>new Promise((a,o)=>{if("number"!=typeof e||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");const i=setTimeout(()=>{if("function"==typeof n){try{a(n())}catch(t){o(t)}return}const s=n instanceof Error?n:new r("string"==typeof n?n:`Promise timed out after ${e} milliseconds`);"function"==typeof t.cancel&&t.cancel(),o(s)},e);s(t.then(a,o),()=>{clearTimeout(i)})});t.exports=a,t.exports.default=a,t.exports.TimeoutError=r},function(t,e,n){"use strict";t.exports=(t,e)=>(e=e||(()=>{}),t.then(t=>new Promise(t=>{t(e())}).then(()=>t),t=>new Promise(t=>{t(e())}).then(()=>{throw t})))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(14);e.default=class{constructor(){this._queue=[]}enqueue(t,e){const n={priority:(e=Object.assign({priority:0},e)).priority,run:t};if(this.size&&this._queue[this.size-1].priority>=e.priority)return void this._queue.push(n);const r=s.default(this._queue,n,(t,e)=>e.priority-t.priority);this._queue.splice(r,0,n)}dequeue(){const t=this._queue.shift();return t&&t.run}get size(){return this._queue.length}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n){let s=0,r=t.length;for(;r>0;){const a=r/2|0;let o=s+a;n(t[o],e)<=0?(s=++o,r-=a+1):r=a}return s}},function(t,e,n){"use strict";n.r(e);var s=n(4),r=n(5),a=n.n(r),o=n(6),i=n.n(o);function u(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var l=n(2),c=n.n(l),d=function(t){function e(){return t.apply(this,arguments)||this}u(e,t);var n=e.prototype;return n.init=function(){t.prototype.init.call(this),this.months=[app.translator.trans("datitisev-dashboard.admin.dashboard.months.january"),app.translator.trans("datitisev-dashboard.admin.dashboard.months.february"),app.translator.trans("datitisev-dashboard.admin.dashboard.months.march"),app.translator.trans("datitisev-dashboard.admin.dashboard.months.april"),app.translator.trans("datitisev-dashboard.admin.dashboard.months.may"),app.translator.trans("datitisev-dashboard.admin.dashboard.months.june"),app.translator.trans("datitisev-dashboard.admin.dashboard.months.july"),app.translator.trans("datitisev-dashboard.admin.dashboard.months.august"),app.translator.trans("datitisev-dashboard.admin.dashboard.months.september"),app.translator.trans("datitisev-dashboard.admin.dashboard.months.october"),app.translator.trans("datitisev-dashboard.admin.dashboard.months.november"),app.translator.trans("datitisev-dashboard.admin.dashboard.months.december")]},n.content=function(){var t=app.data["datitisev-dashboard"],e=t.userCount,n=t.discussionCount,s=t.postCount;return m("div",{className:"DashboardGraph--Categories"},m("div",{className:"DashboardGraph--Category Category--Users"},m("span",{className:"color"}),app.translator.trans("datitisev-dashboard.admin.dashboard.graph.users"),m("br",null),m("span",{className:"number"},e)),m("div",{className:"DashboardGraph--Category Category--Discussions"},m("span",{className:"color"}),app.translator.trans("datitisev-dashboard.admin.dashboard.graph.discussions"),m("br",null),m("span",{className:"number"},n)),m("div",{className:"DashboardGraph--Category Category--Posts"},m("span",{className:"color"}),app.translator.trans("datitisev-dashboard.admin.dashboard.graph.posts"),m("br",null),m("span",{className:"number"},s)))},n.className=function(){return"DashboardGraph"},n.graphView=function(){return m("div",{className:"DashboardGraph--Graph"},Object.keys(this.months).map(function(t){var e=months[t];return m("div",{className:"DashboardGraph--Month"},m("div",{className:"bars"},"BAR"),m("div",{className:"name"},e))}))},e}(c.a),h=n(1),p=n.n(h),f=n(0),v=n.n(f),b=n(3),y=n.n(b),_=n(7),g=n.n(_),x=function(t){function e(){return t.apply(this,arguments)||this}u(e,t);var n=e.prototype;return n.init=function(){this.loading=!0,this.needsUpdate=[],this.errors=[],this.getPackagesAndVersions()},n.className=function(){return"DashboardSettingsModal ExtensionUpdatesModal Modal--large"},n.title=function(){var t=this.needsUpdate.length;return t>0?app.translator.transChoice("datitisev-dashboard.admin.dashboard.updates.available",t,{count:t}):this.loading?app.translator.trans("datitisev-dashboard.admin.dashboard.updates.checking"):0===t?app.translator.trans("datitisev-dashboard.admin.dashboard.updates.none"):void 0},n.content=function(){var t=this;return m("div",{className:"PermissionGrid container"},m("table",{className:"PermissionGrid",style:this.errors||0!==this.needsUpdate.length?"":"display: none"},m("thead",null,m("tr",null,m("th",null,"Extension",this.loading&&m("span",null,"  ",m("i",{className:"fas fa-circle-notch fa-spin"}))),m("th",null,"Version Installed"),m("th",null,"New Version"))),m("tbody",null,Object.keys(this.needsUpdate).map(function(e){var n=t.needsUpdate[e];return m("tr",{className:"PermissionGrid-child"},m("td",null,n.name),m("td",null,n.oldVersion),m("td",null,n.newVersion))}),this.errors&&this.errors.map(function(t){return m("tr",{className:"ExtensionUpdatesModal--Error PermissionGrid-child"},m("td",null,t.name),m("td",null,t.version),m("td",null,t.error))}))),m("div",{style:0!==this.needsUpdate.length||this.errors||this.loading?"display: none":""},m("h3",null,app.translator.trans("datitisev-dashboard.admin.dashboard.updates.none"))))},n.getPackagesAndVersions=function(){var t=this,e=new g.a({intervalCap:2,interval:500}),n=Object.values(app.data.extensions).filter(function(t){return!t.version.startsWith("dev")}).map(function(e){return function(){return m.request({url:"https://packagist.org/packages/"+e.name+".json"}).then(function(n){n=n.package;var s=Object.keys(n.versions).filter(function(t){return!t.startsWith("dev")})[0],r=e.version;s&&r!==s&&(t.extensionUpdates=t.needsUpdate.length+1,t.needsUpdate.push({name:e.name,oldVersion:r,newVersion:s}))}).catch(function(n){if(!n||"object"!=typeof n||!n.message)return!1;t.errors.push({name:e.name,version:e.version,error:n.status?n.status+": "+n.message:n.message})})}});m.startComputation(),e.addAll(n).then(function(){t.loading=!1,m.endComputation()})},e}(y.a),C=n(8),w=n.n(C),I=n(9),E=n.n(I),N=function(t){function e(){return t.apply(this,arguments)||this}u(e,t);var n=e.prototype;return n.init=function(){t.prototype.init.call(this),this.extension=this.props.extension},n.className=function(){return"DashboardExtensionInfoModal Modal--large"},n.content=function(){var t=this.extension,e=this.isEnabled(t.id);return m("div",{className:"DashboardExtensionInfo"},m("div",{className:"Modal-close App-backControl"},this.loading&&m(E.a,{className:"LoadingIndicator--inline"}),e&&app.extensionSettings[t.id]&&p.a.component({icon:"fas fa-cog",onclick:function(){return app.extensionSettings[t.id]()},className:"Button Button--icon Button--link"}),!e&&p.a.component({icon:"fas fa-unlink",onclick:this.uninstall.bind(this),className:"Button Button--icon Button--link"}),p.a.component({icon:"fas fa-times",onclick:this.hide.bind(this),className:"Button Button--icon Button--link"})),m("div",{className:"DashboardExtensionInfo-Main"},m("spam",{className:"DashboardExtensionInfoMain-icon",style:t.icon},t.icon?v()(t.icon.name):""),m("h3",{className:"DashboardExtensionInfoMain-title"},t.extra["flarum-extension"].title),m("span",{className:"DashboardExtensionInfoMain-name"},t.name),m("span",{className:"DashboardExtensionInfoMain-version"},t.version),m("p",{className:"DashboardExtensionInfoMain-description"},t.description||""),m("p",{className:"DashboardExtensionInfoMain-useful"},m("p",{className:"DashboardExtensionInfoMainUseful-author"},t.authors&&1===t.authors.length?v()("fas fa-user"):v()("fas fa-users")," ",t.authors?t.authors.map(function(t){return t.name}).join(", "):"Unknown"),m("p",{className:"DashboardExtensionInfoMainUseful-source"},v()("fas fa-code")," ",t.source?m("a",{href:t.source.url,target:"_blank"},"Source"):"Unknown")),m("div",{className:"DashboardExtensionInfoMain-enabled"},w.a.component({state:e,children:e?"Enabled":"Disabled",onchange:this.toggle.bind(this,t.id)}))))},n.isDismissible=function(){return!0},n.isEnabled=function(t){return JSON.parse(app.data.settings.extensions_enabled).includes(t)},n.toggle=function(t){var e=this.isEnabled(t);app.request({url:app.forum.attribute("apiUrl")+"/extensions/"+t,method:"PATCH",data:{enabled:!e}}).then(function(){var n=JSON.parse(app.data.settings.extensions_enabled);e?n.splice(n.indexOf(t),1):n.push(t),app.data.settings.extensions_enabled=JSON.stringify(n),m.redraw()})},n.uninstall=function(){var t=this;return this.loading=!0,app.request({url:app.forum.attribute("apiUrl")+"/extensions/"+this.extension.id,method:"DELETE"}).then(function(){t.loading=!1,m.redraw()})},e}(y.a),O=function(t){function e(){return t.apply(this,arguments)||this}u(e,t);var n=e.prototype;return n.content=function(){var t=this,e=app.data.extensions;return m("div",null,m("div",{className:"DashboardExtensions--Title"},m("span",null,app.translator.trans("core.admin.nav.extensions_button")),p.a.component({children:v()("fas fa-upload"),className:"Button",onclick:function(){return app.modal.show(new x)}})),m("div",{className:"DashboardExtensions--List"},Object.values(e).map(function(e){return m("li",{className:"DashboardExtensions--Item "+(t.isEnabled(e.id)?"enabled":"disabled"),onclick:function(){return app.modal.show(new N({extension:e}))}},m("div",{className:"DashboardExtensionsItem-content"},m("spam",{className:"DashboardExtensionsItem-icon",style:e.icon},e.icon?v()(e.icon.name):""),m("label",{className:"DashboardExtensionsItem-title"},e.extra["flarum-extension"].title)))})))},n.isEnabled=function(t){return JSON.parse(app.data.settings.extensions_enabled).includes(t)},n.className=function(){return"DashboardExtensions"},e}(c.a);app.initializers.add("datitisev/dashboard",function(){Object(s.extend)(a.a.prototype,"items",function(t){t.remove("extensions")}),Object(s.extend)(i.a.prototype,"availableWidgets",function(t){t.push(m(d,null)),t.push(m(O,null))})})}]);
//# sourceMappingURL=admin.js.map